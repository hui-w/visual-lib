/** 
* Data Visualization Library (Release Version Beta E806)
* @author Wang, Hui (huiwang@qlike.com) 
* @repo https://github.com/hui-w/visual-lib
* @licence MIT 
*/ Element.prototype.createChild=function(a,c,d){var b=document.createElement(a);this.appendChild(b);if(c){for(key in c){b.setAttribute(key,c[key])}}if(d){b.innerHTML=d}return b};var canvasPrototype=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;canvasPrototype.fillTextWithRotate=function(d,a,f,c,b,e){this.save();this.translate(a,f);this.rotate(c);this.fillTextEx(d,0,0,b,e);this.restore()};canvasPrototype.fillTextEx=function(e,b,g,c,f){this.save();var a=b;if(c!="left"){var d=this.measureText(e).width;if(c=="center"){a-=d/2}else{if(c=="right"){a-=d}}}this.textBaseline=f;this.fillText(e,a,g);this.restore()};canvasPrototype.bezierEllipse=function(d,h,f,c){var g=0.5*f,e=0.6*c;this.save();this.translate(d,h);this.beginPath();this.moveTo(0,c);this.bezierCurveTo(g,c,f,e,f,0);this.bezierCurveTo(f,-e,g,-c,0,-c);this.bezierCurveTo(-g,-c,-f,-e,-f,0);this.bezierCurveTo(-f,e,-g,c,0,c);this.closePath();this.restore()};canvasPrototype.antiFuzzyLine=function(b,d,a,c){if(this.lineWidth==1){b-=0.5;d-=0.5;a-=0.5;c-=0.5}this.moveTo(b,d);this.lineTo(a,c)};canvasPrototype.fillSample=function(d,c,b,a){this.save();this.fillStyle="RGBA(255, 0, 0, 0.3)";this.fillRect(d,c,b,a);this.restore()};canvasPrototype.strokeSample=function(d,c,b,a){this.save();this.strokeStyle="RGBA(255, 0, 0, 0.3)";this.strokeRect(d,c,b,a);this.restore()};function toDecimal(a){var b=parseFloat(a);if(isNaN(b)){return}b=Math.round(a*100)/100;return b}function isset(a){return typeof a!="undefined"}function ChartBase(a){for(key in ChartBase.prototype){a.prototype[key]=ChartBase.prototype[key]}}ChartBase.prototype={canvas:null,context:null,width:null,height:null,wrapperId:null,colors:["#00B1D4","#FF0036","#00D435","#FF9100","#DE4574","#8B4AB5","#DFD80F","#009F73","#4057A7","#D55E00"],currentColorIndex:0,borderColor:"#000000",borderSize:1,padding:{top:10,right:10,bottom:10,left:10},clientRect:{left:0,top:0,width:0,height:0},contentArea:{left:0,top:0,right:0,bottom:0,width:0,height:0,centerx:0,centery:0},getClientId:function(){return this.wrapperId+"_canvas"},angleToRadian:function(a){return a/180*Math.PI},radianToAngle:function(a){return a*180/Math.PI},preRender:function(){var a=document.getElementById(this.wrapperId);this.canvas=a.createChild("canvas",{id:this.getClientId(),width:this.width,height:this.height});if(typeof G_vmlCanvasManager!="undefined"){this.canvas=G_vmlCanvasManager.initElement(this.canvas)}this.context=this.canvas.getContext("2d")},preRedraw:function(){this.clientRect.left=this.borderSize;this.clientRect.top=this.borderSize;this.clientRect.width=this.width-2*this.borderSize;this.clientRect.height=this.height-2*this.borderSize;this.contentArea.left=this.clientRect.left+this.padding.left;this.contentArea.top=this.clientRect.top+this.padding.top;this.contentArea.right=this.clientRect.left+this.clientRect.width-this.padding.right;this.contentArea.bottom=this.clientRect.top+this.clientRect.height-this.padding.bottom;this.contentArea.width=this.contentArea.right-this.contentArea.left;this.contentArea.height=this.contentArea.bottom-this.contentArea.top;this.contentArea.centerX=this.contentArea.left+this.contentArea.width/2;this.contentArea.centerY=this.contentArea.top+this.contentArea.height/2;this.context.clearRect(this.clientRect.left,this.clientRect.top,this.clientRect.width,this.clientRect.height);if(this.borderSize>0){this.context.save();this.context.strokeStyle=this.borderColor;this.context.lineWidth=this.borderSize;this.context.strokeRect(this.borderSize/2,this.borderSize/2,this.width-this.borderSize,this.height-this.borderSize);this.context.restore()}},getEventPosition:function(a){return{x:a.pageX-this.canvas.offsetLeft,y:a.pageY-this.canvas.offsetTop}},resetColor:function(){this.currentColorIndex=0},getNextColor:function(){return this.colors[this.currentColorIndex++%this.colors.length]}};function AxisChart(b,a,c){ChartBase(AxisChart);this.width=b;this.height=a;this.wrapperId=c;this.data=[];this.keys=[];this.showShadow=false;this.shadowStyle={offsetX:10,offsetY:5,blur:2,color:"RGBA(0, 0, 0, 0.5)"};this.showGrid=false;this.xLabel="x axis";this.yLabel="y axis";this.showAxis=true;this.showScaleLabel=true;this.showKeys=true;this.scaleCount=5;this.zeroAsOrigin=true;this.scaleLineColor="#000";this.scaleLineSize=1;this.keyFont={size:12,face:"verdana",color:"#000000"};this.keyRotate=0;this.keyBaseline="top";this.keyAltitude=0;this.barDensity=0.7;this.barSpacing=2;this.arrowSize=16;this.arrowStyle=0;this.selectedBarColor="RGBA(242,88,34,0.8)";this.showValueOnBar=false;this.lineSize=2;this.linePointSize=4;this.fitting=false;this.showSlider=false;this.sliderWidth=12;this.sliderHeight=16;this.sliderAltitude=-32;this.sliderBlurColor="RGB(51, 171, 222)";this.sliderFocusColor="RGBA(51, 171, 222, 0.5)";this.maxValue=null;this.minValue=null;this.valueCount=0;this.barCount=0;this.unitWidth=0;this.unitHeight=0;this.unitLeft=[];this.verticalScales=[];this.minScale=null;this.maxScale=null;this.mousePosition=null;this.sliderPosition=null;this.holdingSlider=false;this.selChanged=null;this.selectedIndex=-1}AxisChart.prototype={render:function(){var d=this;this.preRender();this.canvas.addEventListener("mousedown",b,false);this.canvas.addEventListener("mouseup",a,false);this.canvas.addEventListener("mouseout",a,false);this.canvas.addEventListener("mousemove",c,false);this.canvas.addEventListener("touchstart",b,false);this.canvas.addEventListener("touchend",a,false);this.canvas.addEventListener("touchmove",c,false);function b(f){d.mousePosition=d.getEventPosition(f);d.redraw(d.mousePosition)}function a(f){d.releaseSlider();d.redraw(d.mousePosition)}function c(i){if(d.holdingSlider){var j=d.mousePosition;d.mousePosition=d.getEventPosition(i);d.sliderPosition.x+=d.mousePosition.x-j.x;var g=d.contentArea.left+d.arrowSize/2;var h=(d.sliderPosition.x-g)/d.unitWidth;if(h>0){d.setSelectedIndex(Math.floor(h))}else{d.setSelectedIndex(-1)}var f=d.getSliderRange();if(d.sliderPosition.x<f.min){d.sliderPosition.x=f.min}if(d.sliderPosition.x>f.max){d.sliderPosition.x=f.max}d.redraw()}}this.redraw()},getSliderRange:function(){var b=this.contentArea.left+this.arrowSize/2;var a=this.contentArea.right-3*this.arrowSize/2;return{min:b,max:a}},releaseSlider:function(){this.holdingSlider=false;this.mousePosition=null},updateStatus:function(c){this.valueCount=0;this.barCount=0;this.unitLeft=[];for(var g=0;g<this.data.length;g++){var b=this.data[g];if(b.type=="bar"){this.barCount++}if(b.values.length>this.valueCount){this.valueCount=b.values.length}for(var f=0;f<b.values.length;f++){if(b.values[f]>this.maxValue||this.maxValue==null){this.maxValue=b.values[f]}if(b.values[f]<this.minValue||this.minValue==null){this.minValue=b.values[f]}}}if(this.keys.length>this.valueCount){this.valueCount=this.keys.length}var a=this.contentArea.width-2*this.arrowSize;this.unitWidth=a/this.valueCount;var h=this.contentArea.top+1.5*this.arrowSize;this.unitHeight=this.contentArea.bottom-h;for(var g=0;g<this.valueCount;g++){var e=this.contentArea.left+g*this.unitWidth+this.arrowSize/2;this.unitLeft.push(e);this.context.beginPath();this.context.rect(e,h,this.unitWidth,this.unitHeight);if(c&&this.context.isPointInPath(c.x,c.y)){this.setSelectedIndex(g)}}if(this.showSlider){var k=this.contentArea.bottom-this.sliderAltitude;if(this.sliderPosition==null){var d=this.getSliderRange().min;this.sliderPosition={x:d,y:k}}else{this.sliderPosition.y=k}this.context.beginPath();this.context.bezierEllipse(this.sliderPosition.x,this.sliderPosition.y,this.sliderWidth,this.sliderHeight);if(c&&this.context.isPointInPath(c.x,c.y)){this.holdingSlider=true}else{}}},redraw:function(n){this.preRedraw();if(this.data.length==0){return}this.updateStatus(n);this.resetColor();var g=[];for(var t=0;t<this.data.length;t++){var h=this.data[t];var l={};l.color=h.color==null?this.getNextColor():h.color;l.showValueOnBar=isset(h.showValueOnBar)?h.showValueOnBar:this.showValueOnBar;l.fitting=isset(h.fitting)?h.fitting:this.fitting;l.showShadow=isset(h.showShadow)?h.showShadow:this.showShadow;l.lineSize=isset(h.lineSize)?h.lineSize:this.lineSize;l.linePointSize=isset(h.linePointSize)?h.linePointSize:this.linePointSize;g.push(l)}this.verticalScales=this.getVerticalScale(this.minValue,this.maxValue,this.scaleCount,this.zeroAsOrigin);this.minScale=this.verticalScales[0];this.maxScale=this.verticalScales[this.verticalScales.length-1];this.drawScale();var u=0;for(var z=0;z<this.data.length;z++){var h=this.data[z];var l=g[z];if(h.type=="bar"){this.context.save();this.context.fillStyle=l.color;this.context.font="12px verdana";this.context.textBaseline="bottom";if(l.showShadow){this.context.shadowOffsetX=this.shadowStyle.offsetX;this.context.shadowOffsetY=this.shadowStyle.offsetY;this.context.shadowBlur=this.shadowStyle.blur;this.context.shadowColor=this.shadowStyle.color}for(var t=0;t<h.values.length;t++){if(h.values[t]==null){continue}var m=(this.unitWidth*this.barDensity-(this.barCount-1)*this.barSpacing)/this.barCount;var s=this.unitHeight/this.maxScale*(h.values[t]-this.minScale);var q=this.contentArea.top+this.unitHeight-s+1.5*this.arrowSize;var j=this.unitLeft[t]+this.unitWidth*(1-this.barDensity)/2;var e=j+u*(m+this.barSpacing);this.context.beginPath();this.context.rect(parseInt(e),parseInt(q),parseInt(m),parseInt(s));if(this.selectedIndex==t){this.context.fillStyle=this.selectedBarColor}else{this.context.fillStyle=l.color}this.context.fill();if(l.showValueOnBar){var a=this.context.measureText(h.values[t]).width;var b=a<m?e+(m-a)/2:e-(a-m)/2;this.context.fillText(h.values[t],b,q)}}this.context.restore();u++}else{if(h.type=="line"){this.context.save();this.context.fillStyle=l.color;this.context.strokeStyle=l.color;this.context.lineWidth=l.lineSize;if(l.showShadow){this.context.shadowOffsetX=this.shadowStyle.offsetX;this.context.shadowOffsetY=this.shadowStyle.offsetY;this.context.shadowBlur=this.shadowStyle.blur;this.context.shadowColor=this.shadowStyle.color}var c=[0];for(var t=0;t<h.values.length;t++){var v=this.unitHeight/this.maxScale*(h.values[t]-this.minScale);var d=this.contentArea.top+this.unitHeight-v+2*this.arrowSize;d-=l.linePointSize/2;d-=this.arrowSize/2;c.push(d)}c[0]=c[1];c.push(c[c.length-1]+(c[c.length-1]-c[c.length-2]));this.context.beginPath();var o=null;for(var t=0;t<h.values.length;t++){if(h.values[t]==null){continue}var f=this.unitLeft[t];f+=this.unitWidth/2;var d=c[t+1];if(l.linePointSize>0){this.context.moveTo(f+l.linePointSize,d);this.context.arc(f,d,l.linePointSize,0,Math.PI*2,true);this.context.moveTo(f,d)}if(l.fitting){if(t!=h.values.length){for(var r=1;r<=this.unitWidth;r++){var w=this.spline(r/this.unitWidth,c[t],c[t+1],c[t+2],c[t+3]);this.context.lineTo(f+r,w);this.context.moveTo(f+r,w)}}}else{if(o!=null){this.context.moveTo(o.x,o.y);this.context.lineTo(f,d)}o={x:f,y:d}}}this.context.fill();this.context.stroke();this.context.restore()}}}this.drawAxis();this.drawKeys();this.drawSlider(n)},spline:function(c,b,a,e,d){return 0.5*((2*a)+((0-b)+e)*c+((2*b-(5*a)+(4*e)-d)*(c*c)+((0-b)+(3*a)-(3*e)+d)*(c*c*c)))},drawAxis:function(){if(!this.showAxis){return}this.context.save();this.context.beginPath();this.context.moveTo(this.contentArea.left,this.contentArea.bottom);this.context.lineTo(this.contentArea.left,this.contentArea.top+this.arrowSize);this.context.moveTo(this.contentArea.left,this.contentArea.bottom);this.context.lineTo(this.contentArea.right-this.arrowSize,this.contentArea.bottom);this.context.strokeStyle="#000000";this.context.lineWidth=2;this.context.stroke();this.context.beginPath();this.context.moveTo(this.contentArea.left,this.contentArea.top);this.context.lineTo(this.contentArea.left-this.arrowSize/2,this.contentArea.top+this.arrowSize);this.context.lineTo(this.contentArea.left+this.arrowSize/2,this.contentArea.top+this.arrowSize);this.context.closePath();this.context.moveTo(this.contentArea.right,this.contentArea.bottom);this.context.lineTo(this.contentArea.right-this.arrowSize,this.contentArea.bottom-this.arrowSize/2);this.context.lineTo(this.contentArea.right-this.arrowSize,this.contentArea.bottom+this.arrowSize/2);this.context.closePath();if(this.arrowStyle==0){this.context.fillStyle="#000000";this.context.fill()}else{this.context.strokeStyle="#000000";this.context.stroke()}this.context.restore();this.context.save();this.context.fillStyle="rgb(0, 0, 0)";this.context.font="12px verdana";this.context.textBaseline="top";this.context.fillText(this.yLabel,this.contentArea.left+this.arrowSize/2,this.contentArea.top);this.context.fillText(this.xLabel,this.contentArea.right-this.arrowSize,this.contentArea.bottom+this.arrowSize/2);this.context.restore()},drawScale:function(){if(!this.showScaleLabel&&!this.showScaleLine){return}this.context.save();this.context.fillStyle="#000000";this.context.strokeStyle=this.scaleLineColor;this.context.lineWidth=this.scaleLineSize;this.context.font="12px verdana";this.context.textBaseline="bottom";this.context.beginPath();for(var d=0;d<this.verticalScales.length;d++){var a=this.unitHeight/this.maxScale*(this.verticalScales[d]-this.minScale);var f=this.contentArea.top+this.unitHeight-a+1.5*this.arrowSize;if(this.showScaleLabel){var e=this.context.measureText(this.verticalScales[d]).width;var c=this.contentArea.left-e-this.arrowSize/2;this.context.fillText(this.verticalScales[d],c,f)}if(this.showScaleLine&&(d!=0||!this.showAxis)){var g={x:parseInt(this.contentArea.left),y:parseInt(f)};var b={x:parseInt(this.contentArea.right),y:parseInt(f)};this.context.antiFuzzyLine(g.x,g.y,b.x,b.y)}}if(this.showScaleLine){this.context.stroke()}this.context.restore()},drawKeys:function(){if(!this.showKeys){return}this.context.save();this.context.fillStyle=this.keyFont.color;this.context.font=this.keyFont.size+"px "+this.keyFont.face;this.context.textBaseline=this.keyBaseline;var b=this.contentArea.bottom-this.keyAltitude;for(var c=0;c<this.keys.length;c++){var d=this.contentArea.left+c*this.unitWidth+this.arrowSize/2;var e=this.context.measureText(this.keys[c]).width;var a=e<this.unitWidth?d+(this.unitWidth-e)/2:d-(e-this.unitWidth)/2;this.context.fillTextWithRotate(this.keys[c],a,b,this.angleToRadian(this.keyRotate),"left","top")}this.context.restore()},drawSlider:function(b){if(!this.showSlider){return}var a=this.getSliderRange();this.context.save();this.context.beginPath();this.context.lineWidth=1;this.context.strokeStyle="#CCC";this.context.antiFuzzyLine(a.min,this.sliderPosition.y,a.max,this.sliderPosition.y);this.context.stroke();this.context.beginPath();this.context.bezierEllipse(this.sliderPosition.x,this.sliderPosition.y,this.sliderWidth,this.sliderHeight);this.context.strokeStyle=this.sliderBlurColor;if(this.holdingSlider){this.context.fillStyle=this.sliderBlurColor}else{this.context.fillStyle=this.sliderFocusColor}this.context.fill();this.context.restore()},setSelectedIndex:function(b){if(b!=this.selectedIndex){this.selectedIndex=b;if(typeof this.selChanged=="function"){this.selChanged()}if(this.showSlider){if(b==-1){this.sliderPosition.x=this.getSliderRange().min}else{var a=this.unitLeft[b];if(this.sliderPosition.x<a||this.sliderPosition.x>a+this.unitWidth){this.sliderPosition.x=a+this.unitWidth/2}}}return true}else{return false}},selectByIndex:function(a){if(this.setSelectedIndex(a)){this.redraw()}},getVerticalScale:function(e,m,k,b){k=k||5;function p(s){function q(t){if(t==0){return null}if(t/10>=1){return 1+q(t/10)}else{return 0}}function i(t){if(t*10>=1){return -1}else{return -1+i(t*10)}}var r=0;if(s>0&&Math.abs(s)<1){r=i(Math.abs(s))}else{r=q(Math.abs(s))}return r}function l(t){if(t&&t instanceof Array){var s=t.length;var r=0;for(var u=0;u<s;u++){if(!g(t[u])){var q=(t[u]+"").split(".")[1].length;if(q>r){r=q}}}return r}return null}function g(i){return typeof i==="number"&&parseFloat(i)==parseInt(i,10)&&!isNaN(i)}var n=[];var a=(m-e)/k;var d=p(a);var h=l([e,m]);var o=a%Math.pow(10,d)==0?Math.floor(a/Math.pow(10,d))*Math.pow(10,d):(Math.floor(a/Math.pow(10,d))+1)*Math.pow(10,d);var c=Math.floor(e/Math.pow(10,d));var j=(Math.abs(c)-1)<0?0:((c-1)*Math.pow(10,d));for(var f=0;f<=k;f++){n.push((j+o*f).toFixed(h))}return n},getSelectedValues:function(){if(this.selectedIndex==-1||this.data.length==0){return[]}else{var a=[];for(var c=0;c<this.data.length;c++){var b=this.data[c];if(b.values.length>this.selectedIndex){a.push(b.values[this.selectedIndex])}else{a.push(null)}}return a}}};function PieChart(b,a,c){ChartBase(PieChart);this.width=b;this.height=a;this.wrapperId=c;this.data=[];this.dataUnit="Kg";this.selectedBorderColor="#333333";this.selectedBorderSize=4;this.showTitles=true;this.titleFont={size:12,face:"verdana",color:"#000000"};this.showSelectedDetail=false;this.selectedDetailFont={size:12,face:"verdana",color:"#000000"};this.selectedValueFont={size:12,face:"verdana",color:"#000000"};this.baseAngle=270;this.selectMode=1;this.arrowColor="RGBA(255,255,255,0.4)";this.pies=null;this.valueSum=0;this.mousePosition=null;this.mouseDown=false;this.mouseInPie=false;this.inertiaTimer=null;this.angularVelocity=null;this.snapToPieTimer=null;this.selChanged=null;this.selectedIndex=-1}PieChart.prototype={render:function(){var d=this;this.preRender();this.canvas.addEventListener("mousedown",b,false);this.canvas.addEventListener("mouseup",a,false);this.canvas.addEventListener("mouseout",a,false);this.canvas.addEventListener("mousemove",c,false);this.canvas.addEventListener("touchstart",b,false);this.canvas.addEventListener("touchend",a,false);this.canvas.addEventListener("touchmove",c,false);function b(f){d.mouseDown=true;var g=d.selectedIndex;d.mousePosition=d.getEventPosition(f);d.updatePiesInfo();if(d.selectMode==1){if(g!=d.selectedIndex){d.triggerSelChanged();d.redraw(true)}}else{if(d.inertiaTimer){clearInterval(d.inertiaTimer)}}}function a(f){d.mouseDown=false;if(d.selectMode==2){if(d.inertiaTimer){clearInterval(d.inertiaTimer)}if(d.angularVelocity!=null&&d.angularVelocity!=0){d.inertiaTimer=setInterval(function(){if(Math.abs(d.angularVelocity)<1){d.angularVelocity=null;clearInterval(d.inertiaTimer);d.snapToPieCenter()}else{d.angularVelocity*=0.9;d.baseAngle+=d.angularVelocity;d.redraw()}},30)}else{if(d.angularVelocity!=null){d.snapToPieCenter()}}}}function c(g){if(d.selectMode==2&&d.mouseDown&&d.mouseInPie){var i=d.mousePosition;d.mousePosition=d.getEventPosition(g);var f=d.getCircle();var h=d.getDeltaAngle({x:f.x,y:f.y},i,d.mousePosition);d.angularVelocity=Math.round(d.radianToAngle(h));d.baseAngle+=d.angularVelocity;d.redraw()}}this.redraw()},snapToPieCenter:function(){var d=this;var b=this.pies[this.selectedIndex];var a=this.mapAngleInto2pi(b.from,b.to);var f=(a.to-a.from)/2+a.from;var e=Math.PI/2-f;var g=this.radianToAngle(e/10);var c=0;if(d.snapToPieTimer){clearInterval(d.snapToPieTimer)}d.snapToPieTimer=setInterval(function(){d.baseAngle+=g;d.redraw();var h=d.pies[d.selectedIndex];if(++c>=10){clearInterval(d.snapToPieTimer);d.triggerSelChanged();d.redraw()}},30)},getDeltaAngle:function(c,e,d){var b=Math.atan2(e.x-c.x,e.y-c.y);var a=Math.atan2(d.x-c.x,d.y-c.y);return b-a},getCircle:function(){var a=this.contentArea.width;var c=this.contentArea.height;var b=(a<c?a:c)/2;x=this.contentArea.left+b;y=this.contentArea.top+b;return{x:x,y:y,r:b}},updatePiesInfo:function(){this.pies=[];var f=this.getCircle();if(this.selectMode==1){this.selectedIndex=-1}if(this.selectMode==2){this.mouseInPie=false}this.valueSum=0;for(var d=0;d<this.data.length;d++){this.valueSum+=this.data[d].value}var e=this.angleToRadian(this.baseAngle);for(var d=0;d<this.data.length;d++){var c=this.data[d];var b=e+Math.PI*2*c.value/this.valueSum;this.context.beginPath();this.context.moveTo(f.x,f.y);this.context.arc(f.x,f.y,f.r,e,b,false);this.context.closePath();if(this.mousePosition&&this.context.isPointInPath(this.mousePosition.x,this.mousePosition.y)){if(this.selectMode==2){this.mouseInPie=true}if(this.selectMode==1&&this.selectedIndex==-1){this.selectedIndex=d}}this.pies.push({index:d,from:e,to:b});if(this.selectMode==2){var a=this.mapAngleInto2pi(e,b);if(a.from<=Math.PI/2&&a.to>=Math.PI/2){this.selectedIndex=d}}e=b}},triggerSelChanged:function(){if(typeof this.selChanged=="function"){this.selChanged()}},mapAngleInto2pi:function(e,d){var c=Math.floor(d/(Math.PI*2));var a=e-c*Math.PI*2;var b=d-c*Math.PI*2;return{from:a,to:b}},redraw:function(h){this.preRedraw();if(this.data.length==0){return}if(!h||this.pies==null){this.updatePiesInfo()}var b=this.getCircle();var d=0;if(this.selectMode==2){d=4;this.context.save();this.context.fillStyle="#CCCCCC";this.context.beginPath();this.context.arc(b.x,b.y,b.r,0,Math.PI*2,false);this.context.closePath();this.context.fill();this.context.restore()}this.resetColor();for(var e=0;e<this.data.length;e++){var a=this.data[e];if(!a.color){a.color=this.getNextColor()}var f=this.pies[e];if(e!=this.selectedIndex){this.context.save();this.context.beginPath();this.context.moveTo(b.x,b.y);this.context.arc(b.x,b.y,b.r-d,f.from,f.to,false);this.context.closePath();this.context.fillStyle=a.color;this.context.fill();this.context.restore()}}if(this.selectedIndex!=-1){var j=this.pies[this.selectedIndex];if(this.selectMode==1){this.context.save();this.context.beginPath();this.context.moveTo(b.x,b.y);this.context.arc(b.x,b.y,b.r,j.from,j.to,false);this.context.closePath();this.context.fillStyle=this.data[this.selectedIndex].color;this.context.fill();this.context.strokeStyle=this.selectedBorderColor;this.context.lineWidth=this.selectedBorderSize;this.context.stroke();var c=this.data[this.selectedIndex].title+": "+this.data[this.selectedIndex].value+this.dataUnit+" ("+toDecimal(this.data[this.selectedIndex].value/this.valueSum*100)+"%)";this.context.textBaseline="top";this.context.font=this.selectedValueFont.size+"px "+this.selectedValueFont.face;var g=this.context.measureText(c).width;this.context.fillStyle="RGBA(255,255,255,0.6)";this.context.fillRect(this.mousePosition.x,this.mousePosition.y,g,this.selectedValueFont.size*1.2);this.context.fillStyle=this.selectedValueFont.color;this.context.fillText(c,this.mousePosition.x,this.mousePosition.y);this.context.restore()}else{if(this.selectMode==2){this.context.save();this.context.beginPath();this.context.moveTo(b.x,b.y);this.context.arc(b.x,b.y,b.r-d,j.from,j.to,false);this.context.closePath();this.context.fillStyle=this.data[this.selectedIndex].color;this.context.fill();this.context.restore()}}}this.drawTitle();this.drawTriangle();this.drawDataDetail();return},drawTitle:function(){if(!this.showTitles){return}this.context.save();this.context.font=this.titleFont.size+"px "+this.titleFont.face;this.context.textBaseline="top";var g=0;for(var d=0;d<this.data.length;d++){var c=this.data[d];var h=this.context.measureText(c.title).width;if(g<h){g=h}}for(var d=0;d<this.data.length;d++){var c=this.data[d];this.context.fillStyle=this.titleFont.color;var b=this.contentArea.right-g;var a=this.contentArea.top+d*this.titleFont.size*1.5;this.context.fillText(c.title,b,a);this.context.fillStyle=c.color;this.context.strokeStyle="#000000";this.context.lineWidth=1;var f=parseInt(b-this.titleFont.size-this.titleFont.size/6);var e=parseInt(a+this.titleFont.size/6);this.context.fillRect(f,e,this.titleFont.size,this.titleFont.size);if(d==this.selectedIndex){this.context.strokeRect(f-2,e-2,this.contentArea.right-f+4,this.titleFont.size+4)}}this.context.restore()},drawTriangle:function(){if(this.selectMode==2){var b=this.getCircle();var c=b.r/3;this.context.save();this.context.fillStyle=this.arrowColor;this.context.beginPath();this.context.arc(b.x,b.y,b.r,Math.PI*(0.5-0.05),Math.PI*(0.5+0.05),false);this.context.lineTo(b.x,b.y-c+b.r);this.context.moveTo(b.x,b.y);this.context.arc(b.x,b.y,c,0,Math.PI*2,false);this.context.fill();this.context.fillStyle="#fff";var a=12;this.context.font=a+"px verdana";this.context.fillTextEx("Total",b.x,b.y-a,"center","middle");this.context.font=a*1.2+"px verdana";this.context.fillTextEx(this.valueSum+this.dataUnit,b.x,b.y+a,"center","middle");this.context.restore()}},drawDataDetail:function(){var b=-1;if(this.showSelectedDetail){if(this.selectMode==1&&this.selectedIndex!=-1){b=this.selectedIndex}if(this.selectMode==2&&this.selectedIndex!=-1){b=this.selectedIndex}}if(b==-1){return}var h=this.data[b];var j=[];j.push("Total: "+this.valueSum+this.dataUnit);j.push(h.title);j.push(h.value+this.dataUnit);j.push(toDecimal(h.value/this.valueSum*100)+"%");this.context.save();this.context.font=this.selectedDetailFont.size+"px "+this.selectedDetailFont.face;this.context.textBaseline="bottom";var c=0;for(var e=0;e<j.length;e++){var f=this.context.measureText(j[e]).width;if(c<f){c=f}}var g=1.5;var d=this.contentArea.right-c;var a=this.contentArea.bottom-this.selectedDetailFont.size*j.length*g;this.context.fillStyle="RGBA(255,255,255,0.5)";this.context.fillRect(d,a,c,this.selectedDetailFont.size*1.5*j.length);this.context.fillStyle=h.color;for(var e=0;e<j.length;e++){a+=this.selectedDetailFont.size*g;this.context.fillText(j[e],d,a)}this.context.restore()},isInPie:function(b,h,d,i,a,g,c){var e=Math.sqrt((b-d)*(b-d)+(h-i)*(h-i));if(e>a){return false}var f=Math.atan2((b-d),(h-i));g=g%(2*Math.PI);c=c==(2*Math.PI)?(2*Math.PI):(c%(2*Math.PI));if(Math.PI/2-f>=0){f=Math.PI/2-f}else{f=5*Math.PI/2-f}if(f<g||f>c){return false}return true},getSelectedItem:function(){if(this.selectedIndex==-1||this.data.length==0){return null}else{if(this.selectedIndex>=this.data.length){return null}else{return this.data[this.selectedIndex]}}}};function RadarChart(b,a,c){ChartBase(RadarChart);this.width=b;this.height=a;this.wrapperId=c;this.data=[];this.baseValue=0;this.baseAngle=270;this.fillColor="RGBA(255,145,0,0.7)";this.lineColor="RGBA(0,0,0,0.5)";this.outerStyle=0;this.titleFont={size:12,face:"verdana",color:"#4057A7"};this.circle=null;this.points=null;this.dynamicFullValue=null}RadarChart.prototype={render:function(){this.preRender();this.redraw()},postPreRedraw:function(){this.dynamicFullValue=this.baseValue;for(var c=0;c<this.data.length;c++){var b=this.data[c];if(b.value>this.dynamicFullValue){this.dynamicFullValue=b.value}}var a=this.contentArea.width;var e=this.contentArea.height;var d=(a<e?a:e)/2;x=this.contentArea.left+a/2;y=this.contentArea.top+e/2;this.circle={x:x,y:y,r:d};this.adjustRenderObject()},adjustRenderObject:function(){var b=this.contentArea.width;var e=this.contentArea.height;var d=(b<e?b:e)/4;if(this.circle.r<=d){this.circle.r=d;this.points=this.getPointsOnCircle();return}this.points=this.getPointsOnCircle();for(var c=0;c<this.points.length;c++){var a=this.points[c];if(this.contentArea.left-a.textLeft>1){var f=(this.contentArea.left-a.textLeft)/2;this.circle.r-=f;this.circle.x+=f;this.circle.y+=f;this.adjustRenderObject();break}else{if(a.textRight-this.contentArea.right>1){var f=(a.textRight-this.contentArea.right)/2;this.circle.r-=f;this.circle.x-=f;this.circle.y-=f;this.adjustRenderObject();break}else{if(this.contentArea.top-a.textTop>1){var f=(this.contentArea.top-a.textTop)/2;this.circle.r-=f;this.circle.x+=f;this.circle.y+=f;this.adjustRenderObject();break}else{if(a.textBottom-this.contentArea.bottom>1){var f=(a.textBottom-this.contentArea.bottom)/2;this.circle.r-=f;this.circle.x-=f;this.circle.y-=f;this.adjustRenderObject();break}}}}}},getPointsOnCircle:function(){if(this.dynamicFullValue<=0){return[]}var f=2*Math.PI/this.data.length;var n=[];for(var g=0;g<this.data.length;g++){var c=this.data[g];var k=f*g+this.angleToRadian(this.baseAngle);var l=this.circle.x+this.circle.r*Math.cos(k);var j=this.circle.y+this.circle.r*Math.sin(k);var b=this.circle.x+this.circle.r*(c.value/this.dynamicFullValue)*Math.cos(k);var o=this.circle.y+this.circle.r*(c.value/this.dynamicFullValue)*Math.sin(k);this.context.save();this.context.font=this.titleFont.size+"px "+this.titleFont.face;var m=this.context.measureText(c.title).width;this.context.restore();var e=l;var a=j;var h=parseInt(k/(Math.PI/2))%4;var d=2;switch(h){case 0:e=l+d;a=j+d;break;case 1:e=l-m-d;a=j+d;break;case 2:e=l-m-d;a=j-this.titleFont.size-d;break;case 3:e=l+d;a=j-this.titleFont.size-d;break;default:break}if(k/(Math.PI/2)%1==0){e+=(m/2+d)*Math.sin(k);a-=(this.titleFont.size/2+d)*Math.cos(k)}n.push({x:l,y:j,textLeft:e,textTop:a,textRight:e+m,textBottom:a+this.titleFont.size,valueX:b,valueY:o})}return n},redraw:function(){this.preRedraw();if(this.data.length==0){return}this.postPreRedraw();if(this.outerStyle==0){this.context.beginPath();this.context.arc(this.circle.x,this.circle.y,this.circle.r,0,Math.PI*2,false);this.context.closePath();this.context.save();this.context.strokeStyle=this.lineColor;this.context.stroke();this.context.restore()}else{this.context.beginPath();for(var b=0;b<this.points.length;b++){if(b==0){this.context.moveTo(this.points[b].x,this.points[b].y)}else{this.context.lineTo(this.points[b].x,this.points[b].y)}}this.context.closePath();this.context.save();this.context.strokeStyle=this.lineColor;this.context.stroke();this.context.restore()}this.context.beginPath();for(var b=0;b<this.points.length;b++){this.context.moveTo(this.circle.x,this.circle.y);this.context.lineTo(this.points[b].x,this.points[b].y)}this.context.save();this.context.strokeStyle=this.lineColor;this.context.stroke();this.context.restore();this.context.beginPath();for(var b=0;b<this.points.length;b++){var a=this.data[b];if(b==0){this.context.moveTo(this.points[b].valueX,this.points[b].valueY)}else{this.context.lineTo(this.points[b].valueX,this.points[b].valueY)}}this.context.closePath();this.context.save();this.context.fillStyle=this.fillColor;this.context.fill();this.context.restore();this.context.save();for(var b=0;b<this.points.length;b++){this.context.fillStyle=this.titleFont.color;this.context.font=this.titleFont.size+"px "+this.titleFont.face;this.context.textBaseline="top";this.context.fillText(this.data[b].title,this.points[b].textLeft,this.points[b].textTop)}this.context.restore()}};